@()

@main("注册") {
  @views.html.common.header()
  
  <form class="container">
    <div class="input-group mt10">
      <span class="input-group-addon">昵&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;称：</span>
      <input type="text" class="form-control" name="nickname" placeholder="请输入昵称">
    </div>
    <div class="input-group mt10">
      <span class="input-group-addon">邮&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;箱：</span>
      <input type="email" class="form-control" name="email" placeholder="请输入邮箱">
    </div>
    <div class="input-group mt10">
      <span class="input-group-addon">真实姓名：</span>
      <input type="text" class="form-control" name="truename" placeholder="请输入真实姓名">
    </div>
    <div class="input-group mt10">
      <span class="input-group-addon">密&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;码：</span>
      <input type="password" class="form-control" name="password" placeholder="请输入密码">
    </div>
    <div class="input-group mt10">
      <span class="input-group-addon">确认密码：</span>
      <input type="password" class="form-control" name="confirm-password" placeholder="确认您的密码">
    </div>
    <div class="clearfix mt10 row">
      <div class="col-md-11 text-right mt10" id="error-text">
        <label class="control-label"></label>
      </div>
      <div class="col-md-1">
        <button type="button" class="btn btn-primary pull-right">提交</button>
      </div>
    </div>
  </form>

  @views.html.common.footer()
} {
  <script>
    $(function() {
      var $form = $('form.container');
      var $nickname = $('input[name="nickname"]');
      var $email = $('input[name="email"]');
      var $truename = $('input[name="truename"]');
      var $password = $('password');
      var $confirmPassword = $('confirm-password');

      var showError = function(msg) {
        $('#error-text').addClass('has-error').find('.control-label').text(msg);
      };
      var clearError = function() {
        $('#error-text').find('.control-label').text('')
      };
      $form.find('button').on('click', function() {
        if (!$nickname.val()) {
          return showError('请输入昵称！');
        }
        if (!$truename.val()) {
          return showError('请输入真实姓名！');
        }
        if (!$password.val()) {
          return showError('请输入密码！');
        }
        if ($password.val() !== $confirmPassword()) {
          return showError('两次密码输入不一致！');
        }

        $.ajax({
          url: '/ajax/user/regist',
          type: 'post',
          data: $form.serialize()
        }).done(function(data) {
          if (data.status !== 1) {
            return showError(data.msg);
          } else {
            return clearError();
          }
        });
      });
    });
  </script>
}